<!doctype html>
<html lang="en">
<head>  
    <meta charset="utf-8" />
    <title>E-ENROLL</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="icon" href="logo.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ===================== MAIN CONTAINER ===================== -->
    <div class="container" role="main" id="mainContainer">

        <!-- ===================== LEFT PANEL (LOGIN) ===================== -->
        <div class="panel" aria-labelledby="panelTitle">
            <h1 id="panelTitle" class="panel-title">
                <img src="logo.png" alt="Logo" class="panel-logo">
                Enrollment Portal
            </h1>
            <p class="lead">
                Sign in to start enrollment or continue where you left off.
                This demo stores progress in your browser only.
            </p>
            <div id="authArea">
                <form id="loginForm" onsubmit="return false;">
                    <label for="username">Email</label>
                    <input id="username" class="input" placeholder="email" required>

                    <label for="password">Password</label>
                    <input id="password" type="password" class="input" placeholder="password" required>

                    <div style="display:flex;gap:8px;margin-top:8px">
                        <button class="btn" id="loginBtn">Login</button>
                        <button class="btn ghost" id="clearBtn" type="button">Clear</button>
                    </div>
                </form>

                <div class="status" id="status">Not signed in.</div>
            </div>

            <div style="margin-top:12px">
                <h2 style="font-size:14px;margin:0 0 8px">Instructions</h2>
                <p class="muted" style="margin:0">1) Login.</p>
                <p class="muted" style="margin:0">2) Fill enrollment details and check requirements.</p>
                <p class="muted" style="margin:0">3) Upload birth certificate and grade images (Grade 9 & 10).</p>
                <p class="muted" style="margin:0">4) Submit — the final screen shows strand enrollment counts.</p>
            </div>

            <footer>This is a client-only prototype. Files are not sent anywhere.</footer>
        </div>

        <!-- ===================== RIGHT SIDE: STEPS / FORMS ===================== -->
        <div class="steps" aria-labelledby="stepsTitle">
            <h1 id="stepsTitle">Enrollment Steps</h1>
            <div class="stepper" aria-hidden="false">
                <div class="step active" id="s0">1 — Login</div>
                <div class="step" id="s1">2 — Requirements</div>
                <div class="step" id="s2">3 — Upload Documents</div>
                <div class="step" id="s3">4 — Confirm & Submit</div>
            </div>

            <div id="formsContainer">
                <!-- STEP 0: LOGIN REMINDER -->
                <div class="stepPanel active" id="step-0">
                    <p class="muted">
                        You must be signed in to enroll.
                        Use the left panel to sign in. Any non-empty credentials work for this demo.
                    </p>

                    <div class="nav">
                        <div></div>
                        <div><button class="btn" id="startBtn" disabled>Start Enrollment</button></div>
                    </div>
                </div>

                <!-- STEP 1: REQUIREMENTS + PERSONAL INFORMATION FORM -->
                <div class="stepPanel" id="step-1">
                    <form id="enrollForm" onsubmit="return false;">
                        <label>Full Name</label>
                        <input id="fullName" class="input" required>

                        <div class="row">
                            <div class="col">
                                <label>Birthdate</label>
                                <input id="birthdate" type="date" class="input" required>
                            </div>
                            <div class="col">
                                <label>Contact No.</label>
                                <input id="contact" class="input" placeholder="+63..." pattern=".{7,}" required>
                            </div>
                        </div>

                        <label>Address</label>
                        <input id="address" class="input" required>

                        <div class="row">
                            <div class="col">
                                <label>Last School Attended</label>
                                <input id="school" class="input" required>
                            </div>
                            <div class="col">
                                <label>Select Strand</label>
                                <select id="strand" class="select" required>
                                    <option value="">-- choose strand --</option>
                                    <option>STEM</option>
                                    <option>ABM</option>
                                    <option>HUMSS</option>
                                    <option>TVL</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label>Enrollment Requirements — tick when you have the document</label>
                            <div class="req-list">
                                <label><input type="checkbox" id="req-bc"> Birth Certificate (original or certified true copy)</label>
                                <label><input type="checkbox" id="req-grades"> Grades (Grade 9 & Grade 10)</label>
                                <label><input type="checkbox" id="req-id"> Parent/Guardian ID</label>
                            </div>
                        </div>

                        <div class="nav">
                            <button class="btn ghost" id="backFrom1">Back</button>
                            <div>
                                <button class="btn" id="toUpload">Next: Upload</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- STEP 2: FILE UPLOADS -->
                <div class="stepPanel" id="step-2">
                    <div>
                        <label>Upload Birth Certificate (image)</label>
                        <div class="file-drop" id="drop-bc" tabindex="0">
                            <input id="fileBC" type="file" accept="image/*" style="display:none">
                            <div>Drag & drop or click to select image</div>
                            <div class="thumbs" id="thumb-bc"></div>
                        </div>
                    </div>

                    <div>
                        <label>Upload Grade 9 (image)</label>
                        <div class="file-drop" id="drop-g9" tabindex="0">
                            <input id="fileG9" type="file" accept="image/*" style="display:none">
                            <div>Drag & drop or click to select image</div>
                            <div class="thumbs" id="thumb-g9"></div>
                        </div>
                    </div>

                    <div>
                        <label>Upload Grade 10 (image)</label>
                        <div class="file-drop" id="drop-g10" tabindex="0">
                            <input id="fileG10" type="file" accept="image/*" style="display:none">
                            <div>Drag & drop or click to select image</div>
                            <div class="thumbs" id="thumb-g10"></div>
                        </div>
                    </div>

                    <div class="nav">
                        <button class="btn ghost" id="backFrom2">Back</button>
                        <div><button class="btn" id="toSummary">Next: Confirm</button></div>
                    </div>

                    <p class="muted">
                        Images are previewed locally. Max size per file ~5MB (enforced).
                    </p>
                </div>

                <!-- STEP 3: FINAL CONFIRMATION -->
                <div class="stepPanel" id="step-3">
                    <h2 style="margin:0 0 6px">Confirm Enrollment</h2>
                    <div id="summary" style="border-radius:8px; padding:10px; background:rgba(255,255,255,0.01)"></div>
                    <div class="nav">
                        <button class="btn ghost" id="backFrom3">Back</button>
                        <div><button class="btn" id="submitEnroll">Submit Enrollment</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
const $ = id => document.getElementById(id);

// Step management
let currentStep = 0;
const stepIds = [0,1,2,3];

function setActiveStep(i){
    if(typeof i !== 'number' || !stepIds.includes(i)) return;
    currentStep = i;

    // update panels (.stepPanel)
    stepIds.forEach(s => {
        const panel = $('step-'+s);
        if(panel) panel.classList.toggle('active', s === i);
    });

    // update stepper visual badges
    stepIds.forEach(s => {
        const badge = $('s'+s);
        if(badge) badge.classList.toggle('active', s === i);
    });
}

// Auth controls
const loginBtn = $('loginBtn'), clearBtn = $('clearBtn'), startBtn = $('startBtn');

function updateStatus(){
    const user = sessionStorage.getItem('user') || null;
    $('status').textContent = user ? 'Signed in as: ' + user : 'Not signed in.';
    startBtn.disabled = !user;
}

loginBtn.addEventListener('click', (ev) => {
    ev.preventDefault();
    const u = $('username').value.trim(), p = $('password').value.trim();
    if(!u || !p){ alert('Please enter credentials.'); return; }
    sessionStorage.setItem('user', u);
    updateStatus();

    // Expand container and move to step 1 — only if user is signed in
    $('mainContainer').classList.add('expanded');
    const s0 = $('s0'); if(s0) s0.classList.add('completed');

    // Move to step 1 immediately and reliably
    setActiveStep(0);
});

clearBtn.addEventListener('click', (ev) => {
    ev.preventDefault();
    $('username').value=''; $('password').value='';
    sessionStorage.removeItem('user');
    updateStatus();
    $('mainContainer').classList.remove('expanded');
    const s0 = $('s0'); if(s0) s0.classList.remove('completed');
    setActiveStep(0);
});

// Prevent Start if not signed in
startBtn.addEventListener('click', (ev) => {
    ev.preventDefault();
    if(!sessionStorage.getItem('user')) {
        alert('You must sign in first.');
        return;
    }
    // Expand (in case user used start) and move to step 1
    $('mainContainer').classList.add('expanded');
    setActiveStep(1);
});

// Function to prepare summary
function prepareSummary(){
    const summ = $('summary');
    const obj = {
        name: $('fullName').value.trim(),
        birthdate: $('birthdate').value,
        contact: $('contact').value.trim(),
        address: $('address').value.trim(),
        school: $('school').value.trim(),
        strand: $('strand').value,
        reqs: [
            $('req-bc').checked ? 'Birth certificate' : '',
            $('req-grades').checked ? 'Grades 9 & 10' : '',
            $('req-id').checked ? 'Parent ID' : '',
        ].filter(Boolean)
    };
    summ.innerHTML = `
        <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:220px">
                <div style="font-size:13px;color:var(--muted)">Name</div><div style="font-weight:700">${escapeHtml(obj.name)}</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Birthdate</div><div>${obj.birthdate}</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Contact</div><div>${escapeHtml(obj.contact)}</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Address</div><div>${escapeHtml(obj.address)}</div>
            </div>
            <div style="flex:1;min-width:220px">
                <div style="font-size:13px;color:var(--muted)">School</div><div>${escapeHtml(obj.school)}</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Strand</div><div style="font-weight:700" class="strand-name">${escapeHtml(obj.strand)}</div>
                <div style="font-size:13px;color:var(--muted);margin-top:6px">Checked requirements</div><div class="muted">${obj.reqs.join(', ') || '— none'}</div>
            </div>
            <div style="min-width:200px">
                <div style="font-size:13px;color:var(--muted)">Uploaded</div>
                <div style="display:flex;gap:8px;margin-top:6px">
                    <div class="thumb">${ sessionStorage.getItem('thumb-bc') ? '<img src="'+sessionStorage.getItem('thumb-bc')+'" />' : 'BC' }</div>
                    <div class="thumb">${ sessionStorage.getItem('thumb-g9') ? '<img src="'+sessionStorage.getItem('thumb-g9')+'" />' : 'G9' }</div>
                    <div class="thumb">${ sessionStorage.getItem('thumb-g10') ? '<img src="'+sessionStorage.getItem('thumb-g10')+'" />' : 'G10' }</div>
                </div>
            </div>
        </div>`;
}

// From step 1 to 2 or 3
$('toUpload').addEventListener('click', (ev) => {
    ev.preventDefault();
    // require login
    if(!sessionStorage.getItem('user')){
        alert('You must be signed in to continue.');
        setActiveStep(0);
        return;
    }

    const fn = $('fullName').value.trim();
    const bd = $('birthdate').value;
    const contact = $('contact').value.trim();
    const address = $('address').value.trim();
    const strand = $('strand').value;
    if(!fn || !bd || !contact || !address || !strand){
        alert('Please complete all required fields.');
        return;
    }
    // Check if any requirements are checked
    const hasReq = $('req-bc').checked || $('req-grades').checked || $('req-id').checked;
    if (hasReq) {
        setActiveStep(2);
    } else {
        // Skip upload, go to confirm
        prepareSummary();
        setActiveStep(3);
    }
});

// back buttons
$('backFrom1').addEventListener('click', (ev)=> {
    ev.preventDefault();
    // If user is not signed in collapse back to compact view
    if(!sessionStorage.getItem('user')) {
        $('mainContainer').classList.remove('expanded');
        setActiveStep(0);
    } else {
        setActiveStep(0);
    }
});
$('backFrom2').addEventListener('click', (ev)=> { ev.preventDefault(); setActiveStep(1); });
$('backFrom3').addEventListener('click', (ev)=> { ev.preventDefault(); setActiveStep(1); });  // Changed to go back to 1, since might have skipped 2

// drag & drop helpers (unchanged)
function setupDrop(dropId, inputId, thumbId){
    const drop = $(dropId), input = $(inputId), thumbs = $(thumbId);
    if(!drop || !input || !thumbs) return;
    drop.addEventListener('click', ()=> input.click());
    input.addEventListener('change', e => handleFile(e.target.files[0], thumbs));
    drop.addEventListener('dragover', e => { e.preventDefault(); drop.style.borderColor = 'rgba(110,231,183,0.6)'; });
    drop.addEventListener('dragleave', e => { drop.style.borderColor='rgba(255,255,255,0.03)'; });
    drop.addEventListener('drop', e => {
        e.preventDefault(); drop.style.borderColor='rgba(255,255,255,0.03)';
        const f = e.dataTransfer.files[0];
        if(f) { input.files = e.dataTransfer.files; handleFile(f, thumbs); }
    });
}
function handleFile(file, thumbs){
    const maxMB = 5;
    if(!file.type.startsWith('image/')){ alert('Only images allowed.'); return; }
    if(file.size > maxMB*1024*1024){ alert('File too big. Max '+maxMB+'MB.'); return; }
    const reader = new FileReader();
    reader.onload = e => {
        thumbs.innerHTML = '';
        const div = document.createElement('div'); div.className='thumb';
        const img = document.createElement('img'); img.src = e.target.result;
        div.appendChild(img); thumbs.appendChild(div);
        sessionStorage.setItem(thumbs.id, e.target.result);
    };
    reader.readAsDataURL(file);
}

setupDrop('drop-bc','fileBC','thumb-bc');
setupDrop('drop-g9','fileG9','thumb-g9');
setupDrop('drop-g10','fileG10','thumb-g10');

// Prepare summary (unchanged except ensure login)
$('toSummary').addEventListener('click', (ev) => {
    ev.preventDefault();
    if(!sessionStorage.getItem('user')){
        alert('You must be signed in to continue.');
        setActiveStep(0);
        return;
    }
    // Check for required uploads based on checked reqs
    const reqBc = $('req-bc').checked;
    const reqGrades = $('req-grades').checked;
    let missing = [];
    if (reqBc && !sessionStorage.getItem('thumb-bc')) missing.push('Birth Certificate');
    if (reqGrades && !sessionStorage.getItem('thumb-g9')) missing.push('Grade 9');
    if (reqGrades && !sessionStorage.getItem('thumb-g10')) missing.push('Grade 10');
    if (missing.length > 0) {
        if (!confirm('Missing uploads for: ' + missing.join(', ') + '. Proceed anyway?')) return;
    }
    prepareSummary();
    setActiveStep(3);
});

function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// Enrollment submit
$('submitEnroll').addEventListener('click', (ev) => {
    ev.preventDefault();
    if(!sessionStorage.getItem('user')){
        alert('You must be signed in to submit.');
        setActiveStep(0);
        return;
    }
    const strand = $('strand').value;
    if(!strand){ alert('Invalid strand'); return; }
    const raw = localStorage.getItem('strandCounts');
    const counts = raw ? JSON.parse(raw) : {};
    counts[strand] = (counts[strand] || 0) + 1;
    localStorage.setItem('strandCounts', JSON.stringify(counts));
    alert('Successfully registered! Thank you.');
    // Refresh the site after OK is pressed
    location.reload();
});

// init
(function init(){
    updateStatus();
    // ensure panels use .active class instead of display toggles
    setActiveStep(0);
})();

// keyboard accessibility for drop zones
['drop-bc','drop-g9','drop-g10'].forEach(id=>{
    const el = $(id);
    if(!el) return;
    el.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); el.click(); } });
});
</script>
</body>
</html>
